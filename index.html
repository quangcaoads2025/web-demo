<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Popup VÃ²ng Quay</title>

  <style>
  /* ===== NÃšT ğŸ ===== */
  .popup-toggle-btn {
    position: fixed;
    bottom: 10%;
    left: 0;
    background-color: #d60000;
    color: white;
    font-size: 22px;
    padding: 10px 14px;
    border-radius: 0 10px 10px 0;
    cursor: pointer;
    z-index: 100000;
    box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
    pointer-events: auto;
  }

  /* ===== Lá»šP Ná»€N POPUP ===== */
  .popup-widget * { box-sizing: border-box; }
  .popup-widget {
    position: fixed;
    inset: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.3);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 99999;
    font-family: Arial, sans-serif;
    pointer-events: auto;
  }

  /* ===== Há»˜P POPUP CHÃNH ===== */
  .popup-form {
    background: #ffffff;
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    max-width: 920px;
    width: 100%;
    position: relative;
    overflow: hidden;
    pointer-events: auto;
  }

  /* áº¢NH Ná»€N CHÃŒM CHá»ˆ BÃŠN TRÃI */
  .popup-form::before{ content:none !important; }

  .qcads-left{ position: relative; }
  .qcads-left::before{
    content:"";
    position:absolute;
    inset:0;
    background: url('https://www.ngocanhcm.vn/data/category/thongtinweb.png') no-repeat left center;
    background-size: 115%;
    opacity: 0.12;
    z-index: 0;
    pointer-events: none;
  }
  .qcads-left > *{ position: relative; z-index: 1; }

  /* ===== LAYOUT 2 Cá»˜T ===== */
  .qcads-popup-grid{
    display: flex;
    gap: 20px;
    align-items: stretch;
  }
  .qcads-left{
    flex: 1 1 56%;
    min-width: 0;
    display: flex;
    flex-direction: column;
    min-height: 560px;
  }
  .qcads-right{
    flex: 1 1 44%;
    min-width: 0;
    border-left: 1px solid rgba(0,0,0,0.08);
    padding-left: 18px;
  }

  /* ===== TIÃŠU Äá»€ + MÃ” Táº¢ ===== */
  .popup-form h2, .popup-form p {
    text-align: center;
    font-weight: 700;
  }
  .popup-form h2 { font-size: 18px; color: #222; margin: 0 0 8px; }
  .popup-form p { font-size: 14px; color: #d62828; margin: 0 0 16px; }

  /* ===== INPUT ===== */
  .popup-form input[type="text"], .popup-form input[type="email"] {
    width: 100%;
    padding: 10px;
    margin: 8px 0;
    border: 1px solid #ccc;
    border-radius: 8px;
    background: transparent;
    color: #000;
    font-size: 15px;
    font-weight: 500;
  }
  .popup-form input::placeholder { color: #111; opacity: 1; }
  .popup-form input[type="checkbox"] { margin-right: 6px; }
  .popup-form label {
    font-size: 12px;
    display: flex;
    align-items: center;
    margin-top: 6px;
  }

  /* ===== NÃšT SUBMIT ===== */
  .popup-form button {
    background: red;
    color: white;
    padding: 12px 16px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 10px;
  }

  /* HÃ ng nÃºt: trÃ¡i â€“ pháº£i */
  .popup-form .form-actions{
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    margin-top: 10px;
  }
  .popup-form .form-actions #submitBtn{ margin-top: 0; }
  .popup-form .form-actions .dismiss-link{
    margin-left: 0;
    color: blue;
    text-decoration: underline;
    cursor: pointer;
    font-size: 14px;
    font-weight: 700;
    white-space: nowrap;
  }

  /* ===== NÃšT ÄÃ“NG ===== */
  .close-btn {
    position: absolute;
    top: 12px; right: 16px;
    cursor: pointer;
    font-size: 22px;
    color: #666;
    z-index: 10;
    pointer-events: auto;
  }

  /* ===== SUCCESS ===== */
  #successMessage {
    display: none;
    text-align: left;
    margin-top: 20px;
    line-height: 1.5;
    font-size: 16px;
  }
  #successMessage h3 {
    color: green;
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 10px;
    text-align: center;
  }
  #successMessage p { margin: 6px 0; }
  #successMessage span#couponCode,
  #successMessage span#wonValue {
    color: red;
    font-size: 18px;
    font-weight: bold;
  }

  /* ===== FOOTER ===== */
  .site-footer {
    text-align: center;
    font-size: 12px;
    color: #777;
    padding: 10px 8px;
    border-top: 1px solid #ddd;
    margin-top: auto;
    background: rgba(255,255,255,0.75);
    backdrop-filter: blur(2px);
  }
  .site-footer strong { color: #111; }

  /* ===== GIFT TEXT ===== */
  .gift-text {
    text-align: center;
    font-size: 18px;
    font-weight: bold;
    color: red;
    line-height: 1.4;
    margin: 6px 0 10px 0;
  }

  /* ===== VÃ’NG QUAY ===== */
  #wheelContainer { display: none; margin-top: 10px; text-align: center; }
  #wheel {
    border-radius: 50%;
    display: block;
    margin: 0 auto;
    border: 6px solid #fff;
    box-shadow: 0 0 25px rgba(255,255,255,0.4), inset 0 0 35px rgba(255,255,255,0.2);
    transition: transform 5s cubic-bezier(.23,1,.32,1);
  }
  .wheel-container {
    position: relative;
    width: 300px;
    height: 300px;
    margin: 0 auto;
  }
  .arrow {
    position: absolute;
    top: -20px; left: 50%;
    transform: translateX(-50%);
    width: 0; height: 0;
    border-left: 18px solid transparent;
    border-right: 18px solid transparent;
    border-bottom: 26px solid #ffde59;
    filter: drop-shadow(0 0 6px #fff);
    z-index: 15;
  }
  .center-button {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 90px; height: 90px;
    border-radius: 50%;
    background: linear-gradient(145deg, #ff007a, #ffde59);
    border: 4px solid white;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    cursor: pointer;
    box-shadow: 0 0 20px #ff007a, 0 0 40px #ffde59, inset 0 0 10px rgba(255,255,255,.5);
    user-select: none; z-index: 10;
    transition: all .3s ease;
  }
  .center-button:hover {
    transform: translate(-50%, -50%) scale(1.05);
    box-shadow: 0 0 25px #ffde59, 0 0 55px #ff007a;
  }
  .center-button span { color: white; font-weight: bold; font-size: 14px; }
  .center-button .pointer {
    position: absolute; top: 4px; left: 50%;
    transform: translateX(-50%);
    width: 0; height: 0;
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-bottom: 15px solid #fff;
    filter: drop-shadow(0 0 4px #fff);
  }
  #result {
    margin-top: 12px;
    font-size: 18px;
    font-weight: bold;
    color: #2c3e50;
    min-height: 28px;
  }

  /* ===== Cá»˜T PHáº¢I ===== */
  .qcads-right-card{
    background: rgba(255,255,255,0.75);
    border-radius: 12px;
    padding: 14px 14px 12px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.06);
  }
  .qcads-hotline{
    display:flex;
    align-items:center;
    justify-content:center;
    margin-bottom: 10px;
  }
  .qcads-hotline .qcads-pill{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding: 10px 12px;
    border-radius: 999px;
    background: #ffffff;
    border: 1px solid rgba(0,0,0,0.08);
    box-shadow: 0 6px 16px rgba(0,0,0,0.07);
    font-weight: 800;
  }
  .qcads-hotline .qcads-pill .qcads-icon{
    width: 30px; height: 30px;
    border-radius: 50%;
    background: #1b5cff;
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size: 16px;
  }
  .qcads-hotline .qcads-pill .qcads-text{
    line-height: 1.1;
    text-align: left;
    font-size: 12px;
    font-weight: 800;
    color:#1a1a1a;
  }
  .qcads-hotline .qcads-pill .qcads-text b{
    display:block;
    font-size: 16px;
    letter-spacing: .3px;
    color:#0a2a7a;
  }
  .qcads-right ul{
    list-style: none;
    margin: 10px 0 14px;
    padding: 0;
  }
  .qcads-right li{
    margin: 8px 0;
    font-size: 15px;
    font-weight: 700;
    color:#222;
    display:flex;
    gap:8px;
    align-items:flex-start;
  }
  .qcads-right li .dot{
    width: 18px;
    flex: 0 0 18px;
    line-height: 1.2;
  }

  .qcads-logo{ display:block; padding: 14px 0 8px; }
  .qcads-logo .logo-box{
    width: 100%;
    height: 180px;
    display:flex;
    align-items:center;
    justify-content:center;
    background: transparent;
    border: none;
    padding: 0;
  }
  .qcads-logo .logo-box img{
    display:block;
    max-width:100%;
    max-height:100%;
    width:auto;
    height:auto;
    object-fit:contain;
  }

  .qcads-right-hot{
    position: relative;
    margin-top: 14px;
    padding: 14px 12px;
    border-radius: 14px;
    text-align: center;
    font-weight: 900;
    font-size: 13.5px;
    line-height: 1.5;
    color: #d60000;
    background: linear-gradient(135deg,#fff5f5,#ffffff,#fff5f5);
    border: 1px dashed rgba(214,0,0,.55);
    box-shadow: 0 8px 22px rgba(214,0,0,.18), inset 0 0 0 1px rgba(214,0,0,.15);
    overflow: hidden;
  }
  .qcads-right-hot::before{
    content: "ğŸ”¥HOTğŸ”¥";
    display: block;
    margin-bottom: 6px;
    font-size: 13px;
    letter-spacing: 1px;
    animation: qcadsHotBlink 1.4s infinite;
  }
  .qcads-right-hot::after{
    content:"";
    position:absolute;
    top:0;
    left:-70%;
    width:60%;
    height:100%;
    background: linear-gradient(120deg,transparent,rgba(255,255,255,0.75),transparent);
    animation: qcadsHotShine 3s infinite;
  }
  @keyframes qcadsHotBlink{ 0%,100%{opacity:1} 50%{opacity:.55} }
  @keyframes qcadsHotShine{ 0%{left:-70%} 100%{left:120%} }

  /* HIá»†U á»¨NG QUÃ€ ğŸ */
  .qcads-right li .dot{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width: 22px;
    height: 22px;
    border-radius: 8px;
    background: rgba(214,0,0,0.08);
    box-shadow: 0 0 0 rgba(214,0,0,0);
    animation: qcadsGiftPulse 1.2s infinite;
  }
  .qcads-right li:nth-child(2) .dot{ animation-delay: .15s; }
  .qcads-right li:nth-child(3) .dot{ animation-delay: .30s; }
  .qcads-right li:nth-child(4) .dot{ animation-delay: .45s; }
  .qcads-right li:nth-child(5) .dot{ animation-delay: .60s; }
  @keyframes qcadsGiftPulse{
    0%{transform:translateY(0) scale(1); box-shadow:0 0 0 rgba(214,0,0,0)}
    40%{transform:translateY(-1px) scale(1.08); box-shadow:0 10px 18px rgba(214,0,0,.15)}
    70%{transform:translateY(0) scale(1.02)}
    100%{transform:translateY(0) scale(1); box-shadow:0 0 0 rgba(214,0,0,0)}
  }

  /* ===== THÃ”NG BÃO CUSTOM (THAY alert) ===== */
  #qcadsAlert{
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 200000;
  }
  .qcads-alert-box{
    background: #fff;
    border-radius: 14px;
    padding: 18px 16px 14px;
    max-width: 420px;
    width: 92%;
    text-align: center;
    box-shadow: 0 20px 40px rgba(0,0,0,.25);
  }
  .qcads-alert-box h3{
    margin: 0 0 8px;
    font-size: 18px;
    font-weight: 900;
    color: #d60000;
  }
  .qcads-alert-box p{
    margin: 0;
    font-size: 14px;
    line-height: 1.5;
    color: #222;
  }
  .qcads-alert-box button{
    margin-top: 12px;
    padding: 10px 16px;
    border-radius: 10px;
    border: none;
    background: #d60000;
    color: #fff;
    font-weight: 800;
    cursor: pointer;
  }

  /* =====================================================
     FIX CHáº®C CHáº®N: áº¨N Cá»˜T PHáº¢I TRÃŠN MOBILE (Äáº¶T CUá»I CÃ™NG)
     ===================================================== */
  @media screen and (max-width: 768px){
    #qcadsPopup .qcads-right,
    #qcadsPopup .qcads-popup-grid > .qcads-right{
      display: none !important;
      width: 0 !important;
      max-width: 0 !important;
      padding: 0 !important;
      margin: 0 !important;
      border: 0 !important;
      overflow: hidden !important;
    }
    #qcadsPopup .qcads-popup-grid{
      display: block !important;
    }
    #qcadsPopup .qcads-left{
      width: 100% !important;
      max-width: 100% !important;
    }
    #qcadsPopup .popup-form{
      max-width: 92% !important;
      padding: 16px !important;
    }
  }
  </style>
</head>

<body>

<!-- NÃºt báº­t popup -->
<div class="popup-toggle-btn" id="qcadsGiftBtn">ğŸ</div>

<!-- Popup chÃ­nh -->
<div class="popup-widget" id="qcadsPopup">
  <div class="popup-form">
    <span class="close-btn" title="ÄÃ³ng" tabindex="0">Ã—</span>

    <div class="qcads-popup-grid">
      <!-- Cá»˜T TRÃI -->
      <div class="qcads-left">
        <h2>ğŸ”¥GIAO DIá»†N NÃ‚NG Cáº¤PğŸ”¥<br>NÃ‚NG Táº¦M TRáº¢I NGHá»†M QUÃ KHÃCH HÃ€NG</h2>
        <p>XE NGá»ŒC ANH â€“ UY TÃN - CHáº¤T LÆ¯á»¢NG - GIÃ Tá»T</p>

        <form id="registerForm">
          <input type="text" name="name" placeholder="TÃªn cá»§a Anh/Chá»‹:*" required />
          <input type="text" name="phone" placeholder="Sá»‘ Ä‘iá»‡n thoáº¡i:*" required />
          <input type="text" name="address" placeholder="Äá»‹a chá»‰ liÃªn há»‡:*" required />
          <input type="text" name="car" placeholder="DÃ²ng xe quan tÃ¢m:*" required />
          <input type="text" name="note" placeholder="YÃªu cáº§u khÃ¡c (náº¿u cÃ³):" />
          <label><input type="checkbox" required /> TÃ´i Ä‘á»“ng Ã½ vá»›i Ä‘iá»u khoáº£n cá»§a Xe Ngá»c Anh</label>

          <div class="form-actions">
            <button type="submit" id="submitBtn">ÄÄ‚NG KÃ NGAY</button>
            <a class="dismiss-link" tabindex="0">Bá»¯a khÃ¡c nha!</a>
          </div>
        </form>

        <!-- VÃ²ng quay -->
        <div id="wheelContainer">
          <div class="wheel-container">
            <div class="arrow"></div>
            <canvas id="wheel" width="300" height="300"></canvas>
            <div class="center-button" id="spinBtn" tabindex="0">
              <div class="pointer"></div>
              <span>Quay</span>
            </div>
          </div>
          <div id="result"></div>
        </div>

        <div id="successMessage">
          <h3>ğŸ‰Cáº¢M Æ N Anh/Chá»‹ <span id="showName"></span><br>ÄÃƒ THAM GIA CHÆ¯Æ NG TRÃŒNHğŸ˜˜</h3>
          <p>MÃƒ QUÃ€ Táº¶NG LÃ€: <span id="couponCode"></span></p>
          <div id="wonValue" class="gift-text"></div>
          <p>VUI LÃ’NG CHá»¤P MÃ€N HÃŒNH HOáº¶C Äá»ŒC TÃŠN KHI NHáº¬N QUÃ€ Táº¶NG.</p>
          <p>ğŸ”” â€œVoucher giáº£m giÃ¡ khÃ´ng quy Ä‘á»•i thÃ nh tiá»n máº·t vÃ  chá»‰ Ã¡p dá»¥ng 01 mÃ£ khi mua xe. MÃ£ giáº£m giÃ¡ Ä‘Æ°á»£c QuangCaoAds lÆ°u Ä‘á»ƒ Ä‘á»‘i chiáº¿u khi thanh toÃ¡n.â€</p>
        </div>

        <div class="site-footer">
          Â© 2025 Báº£n quyá»n thuá»™c vá» <strong>QuangCaoAds</strong> | Thiáº¿t káº¿ bá»Ÿi<br><strong>MKT HLAds - Xe Ngá»c Anh CÃ  Mau</strong>
        </div>
      </div>

      <!-- Cá»˜T PHáº¢I -->
      <div class="qcads-right">
        <div class="qcads-right-card">
          <div class="qcads-hotline">
            <div class="qcads-pill">
              <div class="qcads-icon">â˜</div>
              <div class="qcads-text">
                HOTLINE
                <b>08888 58 200</b>
              </div>
            </div>
          </div>

          <ul>
            <li><span class="dot">ğŸš€</span><span>XE NGá»ŒC ANH â€“ CHÃNH HÃƒNG, GIÃ Tá»T</span></li>
            <li><span class="dot">ğŸ</span><span>Mua xe chuáº©n â€“ GiÃ¡ tá»‘t</span></li>
            <li><span class="dot">ğŸ</span><span>Giao táº­n nhÃ  toÃ n tá»‰nh</span></li>
            <li><span class="dot">ğŸ</span><span>QuÃ  táº·ng háº¥p dáº«n â€“ Tráº£ gÃ³p duyá»‡t nhanh</span></li>
            <li><span class="dot">ğŸ</span><span>Ngá»c Anh ThÆ°Æ¡ng hiá»‡u uy tÃ­nh 30 nÄƒm</span></li>
          </ul>

          <div class="qcads-logo">
            <div class="logo-box">
              <img src="https://bydthanhcong.vn/wp-content/uploads/2025/12/NGOC-ANH-LOGO-01-2048x1600.png" alt="Xe Ngá»c Anh Logo">
            </div>
          </div>

          <div class="qcads-right-hot">
            HÃ£y Ä‘á»ƒ láº¡i thÃ´ng tin, nháº­n ngay chÆ°Æ¡ng trÃ¬nh khuyáº¿n mÃ£i!
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- THÃ”NG BÃO CUSTOM -->
<div id="qcadsAlert">
  <div class="qcads-alert-box">
    <h3>ğŸ ThÃ´ng bÃ¡o</h3>
    <p id="qcadsAlertText"></p>
    <button type="button" id="qcadsAlertOk">ÄÃ£ hiá»ƒu</button>
  </div>
</div>

<!-- Confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script type="text/javascript">
function qcadsShowAlert(text){
  var box = document.getElementById('qcadsAlert');
  var t = document.getElementById('qcadsAlertText');
  if (!box || !t) return;
  t.innerText = text || '';
  box.style.display = 'flex';
}
function qcadsCloseAlert(){
  var box = document.getElementById('qcadsAlert');
  if (!box) return;
  box.style.display = 'none';
}
(function(){
  var ok = document.getElementById('qcadsAlertOk');
  if (ok) ok.addEventListener('click', qcadsCloseAlert);
})();

window.showPopup = function () {
  var popup = document.getElementById('qcadsPopup') || document.querySelector('.popup-widget');
  if (!popup) return;
  popup.style.display = 'flex';

  if (typeof confetti !== 'undefined') {
    confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
    setTimeout(function () {
      confetti({ particleCount: 100, spread: 80, origin: { y: 0.6 } });
    }, 500);
  }
};
window.qcadsHidePopup = function () {
  var popup = document.getElementById('qcadsPopup') || document.querySelector('.popup-widget');
  if (!popup) return;
  popup.style.display = 'none';
};

var canvas = document.getElementById("wheel");
var ctx = canvas.getContext("2d");
var size = canvas.width;
var center = size / 2;

var segments = [
  "Bá»˜ 06 LY<br>THá»¦Y TINH<br>CAO Cáº¤P",
  "VALI<br>CAO Cáº¤P<br>YAMAHA",
  "TAI NGHE<br>AIRPOOD 4",
  "VOUCHER<br>3.000.000Ä",
  "VOUCHER<br>5.000.000Ä"
];
var colors = [
 ["#0099ff","#0059b3"],
 ["#00c2ff","#007ca3"],
 ["#00ffcc","#00b386"],
 ["#ffde59","#c4a000"],
 ["#ff5ebc","#c7007a"]
];
var arc = (2 * Math.PI) / segments.length;
var spinAngle = 0, spinning = false;

var PRIZE_STOCK_KEY = "qcads_prize_stock_v1";

function qcadsInitStockIfNeeded() {
  var raw = localStorage.getItem(PRIZE_STOCK_KEY);
  if (raw) return;
  var stock = { "0": 27, "1": 3, "2": 1 };
  localStorage.setItem(PRIZE_STOCK_KEY, JSON.stringify(stock));
}
function qcadsGetStock() {
  qcadsInitStockIfNeeded();
  try { return JSON.parse(localStorage.getItem(PRIZE_STOCK_KEY) || "{}"); }
  catch (e) { return {}; }
}
function qcadsSaveStock(stock) {
  localStorage.setItem(PRIZE_STOCK_KEY, JSON.stringify(stock));
}
function qcadsPickPrizeIndexByStock(stock) {
  var total = 0;
  for (var k in stock) {
    if (!stock.hasOwnProperty(k)) continue;
    var n = parseInt(stock[k], 10) || 0;
    if (n > 0) total += n;
  }
  if (total <= 0) return null;

  var r = Math.floor(Math.random() * total);
  var acc = 0;

  for (var kk in stock) {
    if (!stock.hasOwnProperty(kk)) continue;
    var nn = parseInt(stock[kk], 10) || 0;
    if (nn <= 0) continue;
    acc += nn;
    if (r < acc) return parseInt(kk, 10);
  }
  return null;
}

function drawWheel() {
  for (var i = 0; i < segments.length; i++) {
    var angle = i * arc;
    var grad = ctx.createLinearGradient(0, 0, size, size);
    grad.addColorStop(0, colors[i][0]);
    grad.addColorStop(1, colors[i][1]);
    ctx.fillStyle = grad;

    ctx.beginPath();
    ctx.moveTo(center, center);
    ctx.arc(center, center, center, angle, angle + arc, false);
    ctx.fill();

    ctx.save();
    ctx.translate(center, center);
    ctx.rotate(angle + arc / 2);
    ctx.fillStyle = "white";
    ctx.font = "bold 16px sans-serif";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    var lines = segments[i].split("<br>");
    var lineHeight = 18;
    var textRadius = center - 45;

    for (var j = 0; j < lines.length; j++) {
      var lineY = (j - (lines.length - 1) / 2) * lineHeight;
      ctx.fillText(lines[j].trim(), textRadius, lineY);
    }
    ctx.restore();
  }
}
drawWheel();

function spin() {
  if (spinning) return;
  spinning = true;

  var stock = qcadsGetStock();
  var selectedIndex = qcadsPickPrizeIndexByStock(stock);

  if (selectedIndex === null) {
    spinning = false;
    qcadsShowAlert("ChÆ°Æ¡ng trÃ¬nh Ä‘Ã£ háº¿t quÃ  táº·ng dÃ nh cho quÃ½ khÃ¡ch hÃ ng. Cáº£m Æ¡n anh/chá»‹ Ä‘Ã£ mua hÃ ng vÃ  sá»­ dá»¥ng dá»‹ch vá»¥.");
    return;
  }

  stock[String(selectedIndex)] = (parseInt(stock[String(selectedIndex)], 10) || 0) - 1;
  if (stock[String(selectedIndex)] < 0) stock[String(selectedIndex)] = 0;
  qcadsSaveStock(stock);

  var segmentDegree = 360 / segments.length;
  var segmentCenterDegree = selectedIndex * segmentDegree + segmentDegree / 2;
  var spins = Math.floor(Math.random() * 4 + 4);
  var finalDegree = spins * 360 + (360 + 270 - segmentCenterDegree) % 360;
  var finalRad = finalDegree * Math.PI / 180;
  var duration = 4000;
  var start = null;

  function rotateWheel(timestamp) {
    if (!start) start = timestamp;
    var progress = timestamp - start;
    var easing = 1 - Math.pow(1 - progress / duration, 3);
    spinAngle = finalRad * easing;

    ctx.clearRect(0, 0, size, size);
    ctx.save();
    ctx.translate(center, center);
    ctx.rotate(spinAngle);
    ctx.translate(-center, -center);
    drawWheel();
    ctx.restore();

    if (progress < duration) {
      requestAnimationFrame(rotateWheel);
    } else {
      window.pendingSegment = segments[selectedIndex];

      var history = JSON.parse(localStorage.getItem("spinHistory") || "{}");
      var phone = document.getElementById('registerForm').elements['phone'].value.trim();
      if (!history[phone]) history[phone] = {};
      if (!history[phone].firstPrize) history[phone].firstPrize = window.pendingSegment;
      else if (!history[phone].secondPrize) history[phone].secondPrize = window.pendingSegment;
      localStorage.setItem("spinHistory", JSON.stringify(history));

      document.getElementById("result").innerText = "ğŸ‰ Báº¡n trÃºng: " + window.pendingSegment;
      spinning = false;
      window.showSuccessAfterSpin();
    }
  }
  requestAnimationFrame(rotateWheel);
}

function qcadsBoot() {
  var closeBtn = document.querySelector('.popup-form .close-btn');
  var dismissLink = document.querySelector('.popup-form .dismiss-link');
  var form = document.getElementById('registerForm');
  var wheelContainer = document.getElementById('wheelContainer');
  var spinBtn = document.getElementById('spinBtn');
  var giftBtn = document.getElementById('qcadsGiftBtn');

  qcadsInitStockIfNeeded();

  if (giftBtn) {
    giftBtn.addEventListener('click', function (e) {
      e.preventDefault();
      e.stopPropagation();
      window.showPopup();
    }, true);
  }

  function hidePopup(){ window.qcadsHidePopup(); }
  if (closeBtn) closeBtn.addEventListener('click', hidePopup);
  if (dismissLink) dismissLink.addEventListener('click', function (e) {
    e.preventDefault();
    hidePopup();
  });

  function isPhoneValid(phone){ return /^0\d{9}$/.test(phone); }

  if (form) {
    form.addEventListener('submit', function (e) {
      e.preventDefault();

      var name = form.elements['name'].value.trim();
      var phone = form.elements['phone'].value.trim();

      if (!isPhoneValid(phone)) {
        qcadsShowAlert('Sá»‘ Ä‘iá»‡n thoáº¡i khÃ´ng há»£p lá»‡ (pháº£i cÃ³ 10 sá»‘ vÃ  báº¯t Ä‘áº§u báº±ng 0).');
        form.elements['phone'].focus();
        return;
      }

      var couponCode = 'NA' + Math.floor(100000 + Math.random() * 900000);
      window.pendingUserName = name;
      window.pendingCouponCode = couponCode;

      var history = JSON.parse(localStorage.getItem("spinHistory") || "{}");
      history[phone] = { lastCoupon: couponCode };
      localStorage.setItem("spinHistory", JSON.stringify(history));

      form.style.display = 'none';
      wheelContainer.style.display = 'block';
      document.getElementById('result').innerText = '';
    });
  }

  window.showSuccessAfterSpin = function () {
    var successMessage = document.getElementById('successMessage');
    wheelContainer.style.display = 'none';
    successMessage.style.display = 'block';

    document.getElementById('showName').innerText = window.pendingUserName || '';
    document.getElementById('couponCode').innerText = window.pendingCouponCode || '';
    document.getElementById('wonValue').innerHTML = (window.pendingSegment || '').replace(/<br\s*\/?>/gi, ' ');
  };

  if (spinBtn) spinBtn.addEventListener('click', spin);

  window.showPopup();
}

if (document.readyState === 'complete' || document.readyState === 'interactive') {
  qcadsBoot();
} else {
  document.addEventListener('DOMContentLoaded', qcadsBoot);
}
</script>

<script type="text/javascript">
function qcadsHasPopupWidget(el) {
  while (el && el !== document) {
    if (el.className && typeof el.className === 'string' && el.className.indexOf('popup-widget') !== -1) return true;
    el = el.parentNode;
  }
  return false;
}
var qcadsPopup = document.querySelector('.popup-widget');

document.addEventListener('contextmenu', function (e) {
  if (qcadsHasPopupWidget(e.target)) e.preventDefault();
});
document.addEventListener('keydown', function (e) {
  if (!qcadsHasPopupWidget(e.target)) return;

  var key = (e.key || '').toLowerCase();
  var isCtrl = !!e.ctrlKey;
  var forbidden = { u:1, s:1, c:1, x:1, i:1 };

  if ((isCtrl && forbidden[key]) || e.key === 'F12') e.preventDefault();
});
if (qcadsPopup) {
  qcadsPopup.style.userSelect = 'none';
  qcadsPopup.addEventListener('copy', function (e) { e.preventDefault(); });
  qcadsPopup.addEventListener('cut', function (e) { e.preventDefault(); });
}
</script>

</body>
</html>
